(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{235:(e,t,i)=>{"use strict";i.d(t,{J:()=>o});var l=i(5155),a=i(2115),r=i(489),n=i(3101),s=i(5016);let c=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef((e,t)=>{let{className:i,...a}=e;return(0,l.jsx)(r.b,{ref:t,className:(0,s.cn)(c(),i),...a})});o.displayName=r.b.displayName},419:(e,t,i)=>{Promise.resolve().then(i.bind(i,2478))},489:(e,t,i)=>{"use strict";i.d(t,{b:()=>s});var l=i(2115),a=i(7602),r=i(5155),n=l.forwardRef((e,t)=>(0,r.jsx)(a.sG.label,{...e,ref:t,onMouseDown:t=>{var i;t.target.closest("button, input, select, textarea")||(null==(i=e.onMouseDown)||i.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var s=n},2196:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});let l=(0,i(1847).A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},2478:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>B});var l=i(5155),a=i(2115),r=i(63),n=i(1972),s=i(5209),c=i(7003),o=i(6170),d=i(235),h=i(7602),u="horizontal",x=["horizontal","vertical"],f=a.forwardRef((e,t)=>{var i;let{decorative:a,orientation:r=u,...n}=e,s=(i=r,x.includes(i))?r:u;return(0,l.jsx)(h.sG.div,{"data-orientation":s,...a?{role:"none"}:{"aria-orientation":"vertical"===s?s:void 0,role:"separator"},...n,ref:t})});f.displayName="Separator";var g=i(5016);let p=a.forwardRef((e,t)=>{let{className:i,orientation:a="horizontal",decorative:r=!0,...n}=e;return(0,l.jsx)(f,{ref:t,decorative:r,orientation:a,className:(0,g.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",i),...n})});p.displayName=f.displayName;var m=i(1786),y=i(5626),v=i(1847);let w=(0,v.A)("MousePointer",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]),j=(0,v.A)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),k=(0,v.A)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),b=(0,v.A)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var N=i(9051);let S=(0,v.A)("Highlighter",[["path",{d:"m9 11-6 6v3h9l3-3",key:"1a3l36"}],["path",{d:"m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4",key:"14a9rk"}]]);var C=i(2196);let R=(0,v.A)("FilePenLine",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]]),D=(0,v.A)("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]),P=(0,v.A)("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),M=(0,v.A)("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]);var A=i(9867);let F=(0,v.A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var T=i(7937);let z=(0,v.A)("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),L=(0,v.A)("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var E=i(8171),$=i(3209),U=i(8728);function B(){let e=(0,r.useRouter)(),{toast:t}=(0,E.dj)(),[i,h]=(0,a.useState)(null),[u,x]=(0,a.useState)(null),[f,g]=(0,a.useState)(0),[v,B]=(0,a.useState)(1),[I,W]=(0,a.useState)(1.5),[J,O]=(0,a.useState)("select"),[H,G]=(0,a.useState)([]),[q,Y]=(0,a.useState)([[]]),[_,X]=(0,a.useState)(0),[V,Z]=(0,a.useState)(!1),[K,Q]=(0,a.useState)([]),[ee,et]=(0,a.useState)("#000000"),[ei,el]=(0,a.useState)("#000000"),[ea,er]=(0,a.useState)(null),[en,es]=(0,a.useState)(null),[ec,eo]=(0,a.useState)(new Map),[ed,eh]=(0,a.useState)(!1),[eu,ex]=(0,a.useState)(!1),[ef,eg]=(0,a.useState)({x:0,y:0}),[ep,em]=(0,a.useState)(null),[ey,ev]=(0,a.useState)(""),[ew,ej]=(0,a.useState)('Pacifico, Georgia, "Times New Roman", serif'),[ek,eb]=(0,a.useState)(!1),eN=(0,a.useRef)(null),eS=(0,a.useRef)(null),eC=(0,a.useRef)(null),eR=(0,a.useRef)(null),eD=(0,a.useRef)(null),eP=(0,a.useRef)(null),eM=(0,a.useRef)(null),eA=(0,a.useRef)(null),[eF,eT]=(0,a.useState)(!1),[ez,eL]=(0,a.useState)(null),eE=e=>{var i;let l=null==(i=e.target.files)?void 0:i[0];l&&"application/pdf"===l.type?(h(l),e$(l)):t({title:"Invalid File",description:"Please select a PDF file",variant:"destructive"})},e$=async e=>{try{let i=await e.arrayBuffer(),l=(await (0,U.getPdfJs)()).getDocument(new Uint8Array(i)),a=await l.promise;x(a),g(a.numPages),B(1),G([]),Y([[]]),X(0),eo(new Map),er(null),es(null),t({title:"PDF Loaded",description:"Successfully loaded PDF with ".concat(a.numPages," pages")})}catch(e){t({title:"Error Loading PDF",description:"Failed to load PDF file",variant:"destructive"})}};(0,a.useEffect)(()=>{u&&(eU(),eB())},[u,v,I,H,ea]),(0,a.useEffect)(()=>{er(null),es(null)},[v,I]),(0,a.useEffect)(()=>{en&&eC.current&&(eC.current.focus(),eC.current.select())},[en]);let eU=async()=>{if(!u||!eN.current||!eS.current)return;if(eR.current){try{eR.current.cancel()}catch(e){}eR.current=null}let e=await u.getPage(v),t=e.getViewport({scale:I}),i=eN.current,l=eS.current,a=i.getContext("2d"),r=l.getContext("2d");if(!a||!r)return;i.width=t.width,i.height=t.height,l.width=t.width,l.height=t.height;let n=e.render({canvasContext:a,viewport:t});eR.current=n;try{await n.promise,eR.current=null}catch(e){if((null==e?void 0:e.name)==="RenderingCancelledException")return;console.error("render error",e);return}r.clearRect(0,0,l.width,l.height),H.filter(e=>e.page===v).forEach(e=>eI(r,e,e.id===ea))},eB=async()=>{if(u&&eS.current)try{let e=await u.getPage(v),t=e.getViewport({scale:I}),i=await e.getTextContent(),l=[],a=eS.current.getContext("2d");if(!a)return;i.items.forEach(e=>{if(e.str&&Array.isArray(e.transform)&&!(e.transform.length<6))try{let i=e.transform[4],r=e.transform[5],[n,s]=t.convertToViewportPoint(i,r),c=Math.sqrt(e.transform[2]**2+e.transform[3]**2)*I,o=Math.max(8,c);a.font="".concat(o,"px Arial");let d=a.measureText(e.str),h=n/I,u=(t.height-s)/I;l.push({str:e.str,x:h,y:u,width:d.width/I,height:o/I,fontSize:o/I})}catch(e){}}),eo(e=>{let t=new Map(e);return t.set(v,l),t})}catch(e){console.error("extract error",e)}},eI=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e.save(),t.type){case"text":{let l=(t.fontSize||12)*I,a=t.x*I,r=t.y*I;if(t.isReplacement&&t.originalWidth&&t.originalHeight){let i=(t.x-1)*I,l=(t.y-t.originalHeight-2)*I,a=(t.originalWidth+4)*I,r=(t.originalHeight+6)*I;e.fillStyle="#ffffff",e.fillRect(i,l,a,r)}if(e.font="".concat(l,"px ").concat(t.fontFamily||"Arial"),e.fillStyle=t.color||"#000",e.fillText(t.text||"",a,r),i){let i=e.measureText(t.text||"");e.strokeStyle="#3b82f6",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(a-2,r-l,i.width,l+6),e.setLineDash([])}break}case"rectangle":e.strokeStyle=t.color||"#000",e.lineWidth=2,e.strokeRect(t.x*I,t.y*I,(t.width||0)*I,(t.height||0)*I);break;case"circle":{e.strokeStyle=t.color||"#000",e.lineWidth=2;let i=Math.sqrt((t.width||0)**2+(t.height||0)**2)/2*I;e.beginPath(),e.arc((t.x+(t.width||0)/2)*I,(t.y+(t.height||0)/2)*I,i,0,2*Math.PI),e.stroke();break}case"highlight":e.fillStyle=(t.color||"#FFFF00")+"40",e.fillRect(t.x*I,t.y*I,(t.width||0)*I,(t.height||0)*I);break;case"draw":if(t.points&&t.points.length>1){e.strokeStyle=t.color||"#000",e.lineWidth=2,e.lineJoin="round",e.lineCap="round",e.beginPath(),e.moveTo(t.points[0].x*I,t.points[0].y*I);for(let i=1;i<t.points.length;i++)e.lineTo(t.points[i].x*I,t.points[i].y*I);e.stroke()}break;case"image":case"signature":if(t.imageData&&t.width&&t.height){let l=new Image,a=t.width*I,r=t.height*I,n=t.x*I,s=t.y*I;l.onload=()=>{try{e.drawImage(l,n,s,a,r),i&&(e.strokeStyle="#3b82f6",e.lineWidth=2,e.setLineDash([5,5]),e.strokeRect(n-2,s-2,a+4,r+4),e.setLineDash([]))}catch(e){}},l.src=t.imageData}}e.restore()},eW=(e,t)=>{var i;let l=H.filter(e=>e.page===v&&"text"===e.type),a=null==(i=eS.current)?void 0:i.getContext("2d");if(!a)return null;for(let i=l.length-1;i>=0;i--){let r=l[i],n=(r.fontSize||12)*I,s=r.x*I,c=r.y*I;a.font="".concat(n,"px ").concat(r.fontFamily||"Arial");let o=a.measureText(r.text||"").width;if(e>=s-4&&e<=s+o+4&&t>=c-n-4&&t<=c+6)return r}return null},eJ=e=>{var i;let l=null==(i=e.target.files)?void 0:i[0];if(!l||!l.type.startsWith("image/"))return void t({title:"Invalid",description:"Pick image",variant:"destructive"});let a=new FileReader;a.onload=e=>{var i;let l=null==(i=e.target)?void 0:i.result,a=new Image;a.onload=()=>{let e=a.width,i=a.height;e>240&&(i=240*i/e,e=240),i>160&&(e=160*e/i,i=160);let r={id:"img-".concat(Date.now()),type:"image",page:v,x:60/I,y:60/I,width:e/I,height:i/I,imageData:l},n=[...H,r];G(n);let s=q.slice(0,_+1);s.push(n),Y(s),X(s.length-1),er(r.id),O("select"),t({title:"Image Added"})},a.src=l},a.readAsDataURL(l),eD.current&&(eD.current.value="")},eO=e=>{let t=[...H,{...e,id:Date.now().toString(),page:v}];G(t);let i=q.slice(0,_+1);i.push(t),Y(i),X(i.length-1)},eH=function(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],l=H.map(i=>i.id===e?{...i,...t}:i);if(G(l),i){let e=q.slice(0,_+1);e.push(l),Y(e),X(e.length-1)}},eG=()=>{en&&(eH(en.id,{text:en.text}),es(null))},eq=async()=>{if(!i)return void t({title:"No file",description:"Load a PDF first",variant:"destructive"});try{t({title:"Saving",description:"Uploading to server..."});let e=new FormData;e.append("file",i),e.append("annotations",JSON.stringify(H)),e.append("pages",String(f));let l=await fetch("/api/pdfbox/apply-annotations",{method:"POST",body:e});if(!l.ok){let e=await l.text();console.error("server error",e),t({title:"Save failed",description:"Server error: ".concat(l.status),variant:"destructive"});return}let a=await l.blob(),r="edited_".concat(i.name),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=r,s.click(),URL.revokeObjectURL(n),t({title:"Saved",description:"Edited PDF downloaded"})}catch(e){console.error(e),t({title:"Save failed",description:"Network or server error",variant:"destructive"})}},eY=()=>{eT(!1),eA.current=null};if((0,a.useEffect)(()=>{_>=q.length&&X(q.length-1)},[q.length]),!i)return(0,l.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,l.jsx)(n.Y,{}),(0,l.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,l.jsx)(s.Q,{items:[{label:"PDF Tools",href:"/"},{label:"Edit PDF",href:"/pdf/edit"}]}),(0,l.jsx)("div",{className:"max-w-2xl mx-auto mt-8",children:(0,l.jsx)($.Zp,{children:(0,l.jsxs)($.Wu,{className:"flex flex-col items-center justify-center py-16",children:[(0,l.jsx)(m.A,{className:"h-16 w-16 text-muted-foreground mb-4"}),(0,l.jsx)("h2",{className:"text-2xl font-semibold mb-2",children:"Edit PDF"}),(0,l.jsx)("p",{className:"text-muted-foreground text-center mb-6",children:"Upload a PDF file to add text, drawings, shapes, highlights and signatures"}),(0,l.jsx)(d.J,{htmlFor:"file-upload",children:(0,l.jsx)(c.$,{asChild:!0,"data-testid":"button-upload",children:(0,l.jsxs)("span",{className:"cursor-pointer",children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Select PDF File"]})})}),(0,l.jsx)(o.p,{id:"file-upload",type:"file",accept:".pdf",onChange:eE,className:"hidden","data-testid":"input-file"}),(0,l.jsxs)(c.$,{variant:"outline",onClick:()=>e.push("/"),className:"mt-4","data-testid":"button-back",children:[(0,l.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Back to Tools"]})]})})})]})]});let e_=[{id:"select",icon:w,label:"Select"},{id:"text",icon:j,label:"Text"},{id:"draw",icon:k,label:"Draw"},{id:"rectangle",icon:b,label:"Rectangle"},{id:"circle",icon:N.A,label:"Circle"},{id:"highlight",icon:S,label:"Highlight"},{id:"image",icon:C.A,label:"Image"},{id:"signature",icon:R,label:"Signature"},{id:"eraser",icon:D,label:"Eraser"}];return(0,l.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,l.jsx)(n.Y,{}),(0,l.jsxs)("div",{className:"flex h-[calc(100vh-4rem)]",children:[(0,l.jsxs)("div",{className:"w-72 border-r bg-card flex flex-col",children:[(0,l.jsxs)("div",{className:"p-4 border-b",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)(d.J,{className:"text-xs mb-2 block",children:"Select PDF"}),(0,l.jsx)(o.p,{type:"file",accept:"application/pdf",onChange:eE,className:"w-full cursor-pointer"})]}),(0,l.jsx)("h3",{className:"font-semibold mb-4",children:"Tools"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:e_.map(e=>(0,l.jsxs)(c.$,{variant:J===e.id?"default":"outline",size:"sm",onClick:()=>O(e.id),className:"flex flex-col h-auto py-3",children:[(0,l.jsx)(e.icon,{className:"h-5 w-5 mb-1"}),(0,l.jsx)("span",{className:"text-xs",children:e.label})]},e.id))})]}),(0,l.jsx)(p,{}),(0,l.jsxs)("div",{className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{className:"text-xs mb-2 block",children:"Color"}),(0,l.jsx)(o.p,{type:"color",value:ei,onChange:e=>{el(e.target.value),et(e.target.value)},className:"h-10 cursor-pointer","data-testid":"input-color"})]}),(0,l.jsx)(p,{}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{_>0&&(X(_-1),G(q[_-1]))},disabled:_<=0,className:"w-full",children:[(0,l.jsx)(P,{className:"mr-2 h-4 w-4"})," Undo"]}),(0,l.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{_<q.length-1&&(X(_+1),G(q[_+1]))},disabled:_>=q.length-1,className:"w-full",children:[(0,l.jsx)(M,{className:"mr-2 h-4 w-4"})," Redo"]})]}),(0,l.jsx)(p,{}),(0,l.jsxs)(c.$,{variant:"default",size:"sm",onClick:eq,className:"w-full",children:[(0,l.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Save PDF"]}),(0,l.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>e.push("/"),className:"w-full",children:[(0,l.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Back"]})]})]}),(0,l.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,l.jsxs)("div",{className:"border-b bg-card p-4 flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>B(Math.max(1,v-1)),disabled:1===v,children:(0,l.jsx)(F,{className:"h-4 w-4"})}),(0,l.jsxs)("span",{className:"text-sm",children:["Page ",v," of ",f]}),(0,l.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>B(Math.min(f,v+1)),disabled:v===f,children:(0,l.jsx)(T.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>W(Math.max(.5,I-.25)),children:(0,l.jsx)(z,{className:"h-4 w-4"})}),(0,l.jsxs)("span",{className:"text-sm w-16 text-center",children:[Math.round(100*I),"%"]}),(0,l.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>W(Math.min(3,I+.25)),children:(0,l.jsx)(L,{className:"h-4 w-4"})})]})]}),(0,l.jsx)("div",{className:"flex-1 overflow-auto bg-muted/20 p-8",children:(0,l.jsxs)("div",{className:"relative mx-auto",style:{width:"fit-content"},children:[(0,l.jsx)("canvas",{ref:eN,className:"border shadow-lg bg-white"}),(0,l.jsx)("canvas",{ref:eS,className:"absolute top-0 left-0",style:{cursor:"select"===J?"default":"crosshair"},onMouseDown:e=>{var i,l;let a=null==(i=eS.current)?void 0:i.getBoundingClientRect();if(!a)return;let r=e.clientX-a.left,n=e.clientY-a.top;if("select"===J){let e=H.find(e=>e.id===ea&&e.page===v);if(e&&("image"===e.type||"signature"===e.type)){let t=((e,t,i)=>{if("image"!==i.type&&"signature"!==i.type||!i.width||!i.height)return null;let l=i.x*I,a=i.y*I,r=i.width*I,n=i.height*I;for(let[i,s]of Object.entries({nw:[l,a],ne:[l+r,a],sw:[l,a+n],se:[l+r,a+n]}))if(e>=s[0]-8&&e<=s[0]+8&&t>=s[1]-8&&t<=s[1]+8)return i;return null})(r,n,e);if(t){ex(!0),em(t);return}let i=e.x*I,l=e.y*I,a=(e.width||0)*I,s=(e.height||0)*I;if(r>=i&&r<=i+a&&n>=l&&n<=l+s){eh(!0),eg({x:r-i,y:n-l});return}}let t=H.find(e=>("image"===e.type||"signature"===e.type)&&e.page===v&&e.width&&e.height&&r>=e.x*I&&r<=e.x*I+e.width*I&&n>=e.y*I&&n<=e.y*I+e.height*I);if(t){er(t.id),eh(!0),eg({x:r-t.x*I,y:n-t.y*I});return}let i=eW(r,n);if(i){er(i.id);let e=i.x*I,t=i.y*I,l=(i.fontSize||12)*I;es({id:i.id,text:i.text||"",x:e,y:t-l,fontSize:l});return}er(null),es(null);return}if(er(null),es(null),"eraser"===J){let e=((e,t)=>{let i=H.filter(e=>e.page===v);for(let l=i.length-1;l>=0;l--){let a=i[l];if("text"===a.type){let i=eW(e,t);if(i)return i}else if(a.width&&a.height){let i=a.x*I,l=a.y*I,r=a.width*I,n=a.height*I;if(e>=i&&e<=i+r&&t>=l&&t<=l+n)return a}else if(a.points&&a.points.length)for(let i of a.points){let l=e-i.x*I,r=t-i.y*I;if(10>=Math.sqrt(l*l+r*r))return a}}return null})(r,n);if(e){let i=H.filter(t=>t.id!==e.id);G(i);let l=q.slice(0,_+1);l.push(i),Y(l),X(l.length-1),t({title:"Deleted"})}return}if("image"===J){null==(l=eD.current)||l.click();return}if("signature"===J)return void eb(!0);if("draw"===J){Z(!0),Q([{x:r,y:n}]);return}if("text"===J){let e={id:"txt-".concat(Date.now()),type:"text",page:v,x:r/I,y:n/I,text:"",color:ee,fontSize:12,fontFamily:"Arial"},t=[...H,e];G(t);let i=q.slice(0,_+1);i.push(t),Y(i),X(i.length-1),er(e.id),es({id:e.id,text:"",x:r,y:n-14,fontSize:12*I});return}Z(!0),Q([{x:r,y:n}])},onMouseMove:e=>{var t,i,l,a;let r=null==(t=eS.current)?void 0:t.getBoundingClientRect();if(!r)return;let n=e.clientX-r.left,s=e.clientY-r.top;if(ed&&ea){let e=(n-ef.x)/I,t=(s-ef.y)/I;eP.current={x:e,y:t};let i=null==(l=eS.current)?void 0:l.getContext("2d"),a=eS.current;i&&a&&(i.clearRect(0,0,a.width,a.height),H.filter(e=>e.page===v).forEach(l=>{l.id===ea?eI(i,{...l,x:e,y:t},!0):eI(i,l,!1)}));return}if(eu&&ea&&ep){let e=H.find(e=>e.id===ea);if(!e||!e.width||!e.height)return;let t=n/I,i=s/I,l=e.x,a=e.y,r=e.width,c=e.height;switch(ep){case"se":r=t-e.x,c=i-e.y;break;case"sw":l=t,r=e.x+e.width-t,c=i-e.y;break;case"ne":a=i,r=t-e.x,c=e.y+e.height-i;break;case"nw":l=t,a=i,r=e.x+e.width-t,c=e.y+e.height-i}r>8/I&&c>8/I&&eH(ea,{x:l,y:a,width:r,height:c},!1);return}if(!V)return;if("draw"===J){Q(e=>[...e,{x:n,y:s}]);let e=null==(a=eS.current)?void 0:a.getContext("2d");e&&K.length&&(e.strokeStyle=ei,e.lineWidth=2,e.lineCap="round",e.beginPath(),e.moveTo(K[K.length-1].x,K[K.length-1].y),e.lineTo(n,s),e.stroke());return}let c=null==(i=eS.current)?void 0:i.getContext("2d");if(!c||0===K.length)return;let o=eS.current;c.clearRect(0,0,o.width,o.height),H.filter(e=>e.page===v).forEach(e=>eI(c,e,e.id===ea));let d=K[0].x,h=K[0].y,u=n-d,x=s-h;if(c.strokeStyle=ei,c.lineWidth=2,"rectangle"===J)c.strokeRect(d,h,u,x);else if("circle"===J){c.beginPath();let e=Math.sqrt(u*u+x*x)/2;c.arc(d+u/2,h+x/2,e,0,2*Math.PI),c.stroke()}else"highlight"===J&&(c.fillStyle=ei+"40",c.fillRect(d,h,u,x))},onMouseUp:e=>{var t;if(ed){if(eh(!1),eP.current&&ea)eH(ea,{x:eP.current.x,y:eP.current.y},!0),eP.current=null;else{let e=q.slice(0,_+1);e.push([...H]),Y(e),X(e.length-1)}return}if(eu){ex(!1),em(null);let e=q.slice(0,_+1);e.push([...H]),Y(e),X(e.length-1);return}if(!V)return;let i=null==(t=eS.current)?void 0:t.getBoundingClientRect();if(!i)return;let l=e.clientX-i.left,a=e.clientY-i.top;if("draw"===J)eO({type:"draw",x:K[0].x/I,y:K[0].y/I,points:[...K,{x:l,y:a}].map(e=>({x:e.x/I,y:e.y/I})),color:ei});else if(K.length){let e=K[0].x,t=K[0].y;eO({type:J,x:Math.min(e,l)/I,y:Math.min(t,a)/I,width:Math.abs(l-e)/I,height:Math.abs(a-t)/I,color:ei})}Z(!1),Q([])},onMouseLeave:()=>{Z(!1),Q([])}}),en&&(0,l.jsx)("div",{className:"absolute z-50",style:{left:"".concat(en.x,"px"),top:"".concat(en.y,"px")},children:(0,l.jsx)(o.p,{ref:eC,value:en.text,onChange:e=>es({...en,text:e.target.value}),onBlur:eG,onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),eG()):"Escape"===e.key&&(e.preventDefault(),es(null))},className:"min-w-[200px] h-8 text-sm border-2 border-blue-500",autoFocus:!0})}),(0,l.jsx)(o.p,{ref:eD,type:"file",accept:"image/*",onChange:eJ,className:"hidden"})]})})]}),ek&&(0,l.jsxs)("div",{className:"w-96 border-l bg-card p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("h4",{className:"font-semibold",children:"Add Signature"}),(0,l.jsx)(c.$,{size:"sm",variant:"ghost",onClick:()=>eb(!1),children:"Close"})]}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(d.J,{className:"text-xs",children:"Typed Signature"}),(0,l.jsx)(o.p,{value:ey,onChange:e=>ev(e.target.value),placeholder:"Type your name"}),(0,l.jsx)(d.J,{className:"text-xs",children:"Font"}),(0,l.jsxs)("select",{value:ew,onChange:e=>ej(e.target.value),className:"w-full p-2 border",children:[(0,l.jsx)("option",{value:'Pacifico, Georgia, "Times New Roman", serif',children:"Pacifico / Script"}),(0,l.jsx)("option",{value:"Brush Script MT, Georgia, serif",children:"Brush Script"}),(0,l.jsx)("option",{value:"Segoe Script, Georgia, serif",children:"Segoe Script"}),(0,l.jsx)("option",{value:'Georgia, "Times New Roman", serif',children:"Serif"}),(0,l.jsx)("option",{value:"Arial, Helvetica, sans-serif",children:"Sans"})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(c.$,{onClick:()=>{if(!ey)return void t({title:"Type name",variant:"destructive"});let e=document.createElement("canvas"),i=e.getContext("2d");if(!i)return;i.font="48px ".concat(ew);let l=Math.min(Math.max(200,i.measureText(ey).width+20),800);e.width=l,e.height=80,i.clearRect(0,0,l,80),i.font="48px ".concat(ew),i.textBaseline="middle",i.fillStyle="#000",i.fillText(ey,10,40);let a=e.toDataURL("image/png"),r=[...H,{id:"sig-".concat(Date.now()),type:"signature",page:v,x:60/I,y:60/I,width:l/I,height:80/I,imageData:a}];G(r);let n=q.slice(0,_+1);n.push(r),Y(n),X(n.length-1),t({title:"Signature added"}),eb(!1)},className:"flex-1",children:"Add Typed"}),(0,l.jsx)(c.$,{onClick:()=>ev(""),children:"Clear"})]}),(0,l.jsx)(p,{}),(0,l.jsx)(d.J,{className:"text-xs",children:"Draw Signature"}),(0,l.jsx)("div",{className:"border",children:(0,l.jsx)("canvas",{ref:e=>(e=>{if(eM.current=e,!e)return;e.width=800,e.height=200;let t=e.getContext("2d");t&&(t.clearRect(0,0,e.width,e.height),t.lineWidth=2,t.lineCap="round",t.strokeStyle="#000")})(e),onPointerDown:e=>{if(!eM.current)return;eT(!0);let t=eM.current.getBoundingClientRect();eA.current={x:e.clientX-t.left,y:e.clientY-t.top}},onPointerMove:e=>{if(!eF||!eM.current||!eA.current)return;let t=eM.current.getBoundingClientRect(),i=e.clientX-t.left,l=e.clientY-t.top,a=eM.current.getContext("2d");a&&(a.beginPath(),a.moveTo(eA.current.x,eA.current.y),a.lineTo(i,l),a.stroke(),eA.current={x:i,y:l})},onPointerUp:eY,onPointerLeave:eY,style:{width:"100%",height:120,touchAction:"none",background:"#fff"}})}),(0,l.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,l.jsx)(c.$,{onClick:()=>{if(!eM.current)return;let e=eM.current.toDataURL("image/png");eL(e);let i=new Image;i.onload=()=>{let l=i.width,a=i.height;l>240&&(a=240*a/l,l=240),a>80&&(l=80*l/a,a=80);let r=[...H,{id:"sig-".concat(Date.now()),type:"signature",page:v,x:60/I,y:60/I,width:l/I,height:a/I,imageData:e}];G(r);let n=q.slice(0,_+1);n.push(r),Y(n),X(n.length-1),t({title:"Signature added"}),eb(!1)},i.src=e},className:"flex-1",children:"Save Drawn"}),(0,l.jsx)(c.$,{onClick:()=>{if(!eM.current)return;let e=eM.current.getContext("2d");e&&(e.clearRect(0,0,eM.current.width,eM.current.height),eL(null))},children:"Clear"})]}),(0,l.jsx)(p,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)(d.J,{className:"text-xs",children:"Or upload image"}),(0,l.jsx)(o.p,{type:"file",accept:"image/*",onChange:eJ})]})]})]})]})]})}},7602:(e,t,i)=>{"use strict";i.d(t,{hO:()=>c,sG:()=>s});var l=i(2115),a=i(7650),r=i(2467),n=i(5155),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let i=(0,r.TL)(`Primitive.${t}`),a=l.forwardRef((e,l)=>{let{asChild:a,...r}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(a?i:t,{...r,ref:l})});return a.displayName=`Primitive.${t}`,{...e,[t]:a}},{});function c(e,t){e&&a.flushSync(()=>e.dispatchEvent(t))}},9051:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});let l=(0,i(1847).A)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},9867:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});let l=(0,i(1847).A)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])}},e=>{e.O(0,[489,545,211,519,661,441,255,358],()=>e(e.s=419)),_N_E=e.O()}]);